
----

Is it a good idea for the wasm build from CCP4_WASM_BUILD/moorhen_build compiles test-molecules-container?
How do I use it?
* It might be a good idea, but it is not at all important.

Key-binding for "display/undisplay all maps"
* Done - sort of. Shift Q

Key-binding for "toggle display of last model"
* Done - Shift A.

Key-binding for "Advance scroll-wheel-map to next map" (have I done this?)
* Yes. Shift W

moorhen: atom selection for Mg was grey, not green as it should be.
Even with non-carbon colouring it failed. Using custom rule (from the "+" button)
* Fixed.

moorhen: does the map masking take a multi-cid for the atom selection?
* It does not. Tested.
* Fixed.

moorhen: search monomer library for ARG with methyl (for example)

libcootapi: bundle the reference structures into the source code.

libcootapi: add label_seq_id etc for the residue added in add_terminal_residue

libcootapi: add refinement control parameters to molecules_container,
       torsion weight, rama weight, gm weight and whatever others.

libcootapi: how do I turn on Rama refinement?

libcootapi: work out the arguments for MT2 mesh as glTF.

libcootapi: add a function to copy a map (and a model molecule I guess) for figure making.

libcootapi: replace_molecule_by_model_from_file() should be passed the use_gemmi argument.
            and remove use_gemmi from the coot_molecule class.

libcootapi: See Filo pull request and write a c++ test-molecules-container test for gltf.

moorhen: SMILES: nitrobezene svg ligand rep - charge position size offset of the + and - neeeds
  to be fixed.

libcootapi:
  get rid of #define HAVE_BOOST_BASED_THREAD_POOL_LIBRARY in add-terminal-residue.cc

Coot: Fix this in pyrogen Makefile:
      SWIG_FLAGS = -DSWIG -DCOOT_USE_GTK2_INTERFACE
      Is -DSWIG already on, because it's parsed by swig?
* Done.

libcootapi: what are the headers? Including Remark records?

libcootapi:
   //! generate GM self restraints for the given residues.
   //! `residue_cids" is a "||"-separated list of residues, e.g. "//A/12||//A/14||/B/56"
   void generate_local_self_restraints(int imol, float local_dist_max,
                                       const std::string &residue_cids);
   Make this use "normal" multi-cids
* Done, I think.

moorhen: reading a map often the default (first) contour level is too low.
e.g. the map of 8ox5. Lucrezia to investigate?

moorhen SMILES: nitrobezene svg ligand rep - charge position size offset of the + and - neeeds
  to be fixed.

libcootapi:
  get rid of #define HAVE_BOOST_BASED_THREAD_POOL_LIBRARY in add-terminal-residue.cc

libcootapi: look at merging 7ZTVU (or whatever it was) into a cif file. Look at the output cif for
   ligand: atom_site seq_id.
   Merge a ligand with a long ligand name into a molecule from a PDB file, then try to refine the ligand.

CMakefile/libcootapi: add findligands and findwaters to CMakeLists.txt - Charles

findligands: try with 5-char ligand in 1cxq and write a cif. Eugene says that it fails. Does it?

Nice to have: add a SSBOND to a PDB or cif and it does the check that the residues are there and adds the record.

ligand figures from the chem_comp_atom_depiction_t
* Semi done, need to work in the Coot part also.

MMDB: Look at mmdb chain selection. Can you remove chain range?
      chain-id range test: Look at assembly cif for examples of chain-range-like chain-ids.
      Use one of them for an atom selection test.
      Tweak ParseSelectionPath().

libcootapi: dependencies clipper:
   $ egrep ' -L=/' $prefix/lib/lib*.la
   Needs fixing. Configuring and building clipper solo, the la files do not show this problem.
   But they do from the build-it-3-3 script? (needs testing from fresh).

libcootapi: #include <GL/gl.h> in CXXSurface/CXXVCN.h - remove it if you can.
* I can. Done.

libcootapi: return a double (ms) test_the_threading(int n_threads)
* Done.

libcootapi: Have a look at this when compiling with emscripten
   #ifndef __NVCC__
   #ifdef HAVE_BOOST
   #define HAVE_BOOST_BASED_THREAD_POOL_LIBRARY
* Done.

libcootapi: Bring HOLE to the api - and possibly map carving.

libcootapi: cif parsing: let's have the acedrg version of gphl_chem_comp_info

// This needs a look. When did I comment this out? And why?
ligand/residue_by_phi_psi.hh:// #define HAVE_BOOST_BASED_THREAD_POOL_LIBRARY
Can I use residue_by_phi_psi multi-threaded?

Moorhen: Ligand fitting return a triple of the cluster index, the ligand index and the molecule index.
         Ligand solutions have the same position + orientation with even without conformers!

Moorhen: Set a flag for contouring timers. Add them, store the result, and use the flag to get the times.
         Does the contouring write any output? If so, remove it.
* Done.

Graphics: tap, tap tap, tap tap tap left-quote for residue, chain molecule.
* Done.

Graphics: pdb4nia
          coot.set_model_molecule_representation_style(0,1)
          Mg atoms are massive (too big)

GUI: Open Coords dialog, Move molecule here doesn't work.

GUI: add_alt_conf_py(0, "A", 1, "", "", 1) goes interactive. It should just add.

GUI: Read in an mtz file (rnasa fails) and set this map is difference map - this gets ignored.
* Done.

GUI: Search Monomer Library dialog should be an overlay - Job for Jakub.

GUI/Graphics bug:: why are there no labels for 7dy0.cif? Also, it seems very laggy.

GUI/libcootapi: check that DNA is correctly mutate to DNA bases in the Mutate Residue Range gui (do non-gui
    fixes in coot-refinement). Use pdb6pww P chain.
* Done.

GUI: Mutate Residue Range GUI: Match counts doesn't work correctly

GUI: Validate -> Atom Overlaps doesn't work.
Yeah it does.

GUI: Edit -> Settings -> Save current size and position doesn't work.

GUI: save the state and look at the resulting state file. The functions need "coot." module name

GUI: warn user if they have a PDB files and merge in a 5-char ligand. Likewise in Moorhen.

Moorhen: Add a test for multi-threading. Normals of a Gaussian surface?

Bug::? in moving atoms mode centre of 89A sidechain density press e for auto-fit rotamer - I get red rings. Why?

Bug:: Preferences Others Fonts - the Atom Label Radiobuttons are not correctly lit.

Bug:: Missing popup menu in Rigid-body fit toolbar button.

Bug:: if rdkit has not been installed then it should fail in configure
      not when building lidia-core

Bug:: the dialog for selection of column labels from an mtz file is broken,
      can't assign weights, can't assign Fobs.

Bug:: Missing GUI: Rigid-body fit Residue Ranges
* Done.

Bug: 7adk peptide omega plot "" chain is empty. Presumably a libcootapi problem.

GUI: Look at the terminal output when using the Preferences dialog. Is it all needed?

GUI: Difference map peaks are appeaing in the wrong asymmetric unit (it should be
     around the protein, but it seems not).

GUI: Zoom does not change on Playing Views.

GUI: Symmetry by molecule: removed from UI. Buggy. Needs a fix.

GUI: Does "Fetch PDB & Map using EDS" work with Updating maps?

GUI: When I Open Coords I have a option to choose filter to coordinate files.
     When I Auto-open MTZ I dont have a option to choose filter to mtz files.

GUI: Geman-McClure alpha refinement params box menu doesn't show the correct value.

GUI: Update the validation box when "flip peptide" button is pressed.
     Does the updating map update in this case?

GUI: Add a Cryo-EM menu item for solidify maps (currently in coot_gui.py). Don't use python.

GUI: Ctrl-A, Ctrl-E in the python command line

GUI: easier way to set default b-factor: set_default_temperature_factor_from_median()

GUI: If python command fails, I want to somehow see that it failed.

GUI: Rotate/Translate <fragment> doesn't work.

GUI: see a validation graph (geometry) with one chain (e.g. A chain fragment from tutorial-modern).
     The residue labels were getting chopped in half.

GUI: Renumber residue range on a molecule that is not the first molecule ::: 0.6

GUI: Replace-residue is missing. Needs a UI. Make it an overlay.

GUI: Needs a "Trackpad Mode" button in the UI. It should have a "save this mode" button also.

GUI: Fetch Alphafold model that is closest to the sequence of this chain.

GUI: copy fragment dialog doesn't make active the first molecule, but save coordinates does.
     Do the same thing.

GUI: Cryo-EM module: Add Toggle switch for auto-recontour map

GUI: Add curmudgeon-mode ("Particles and Textures Off") in Preferences dialog.

Graphics: Don't draw rama ball when intermediate atoms are from edit chi angles (and some
   others presumably).

Graphics: Check that the Gaussian surface is being displayed before drawing it for the
   SSAO frame-buffer.

Graphics: Fast slide to new position on reading in a new molecule (there is a distance limit
   that means there's a jump - don't use that for read_pdb()).

Graphics: Try Quick save as on a mac and restore settings - the graphics window size is wrong.

Graphics: Don't draw rama balls when intermediate atoms are from edit chi angles (and
          some others presumably).

Graphics: Rigid-body refine the tutorial A chain. It used to display an intermediate
          atoms representation. What happens now and is that what you want?

Graphics: I want to be able to click on the red spots in the "in window" Rama plot.

Graphics/API: give user access to the Gaussian surface parameters.

Graphics: I'd like to be able to move through/select rotamers in moving-atoms mode
          [idea from TC video]

Graphics/libcootapi: write a function to convert a simple mesh to a type-B instanced mesh with
          matrices from BIOMT records.

Graphics/GUI: Martin: Does the Rotate/translate work around the centre of the fragment?

Graphics: Bug: 7dy0 all-atom B-factor - the colour range goes too far (into purple)

API: add rigid_body_fit_chain(imol, chain_id) to the moorhen and coot apis.

Moorhen: Change chain ID

Moorhen: Renumber residue range.

Moorhen: what is the HB type of this atom?
* Done.

Moorhen: colour by conservation (bond/atoms). How about surface?

Moorhen: Export dictionary as string
* Done.

Moorhen: ligand fitting: check the ligand size to blob size. tutorial 1 ligand in the major
         site - there is no conformation variability.

Moorhen: replace fragment: does it take the vertical bar?
         https://github.com/moorhen-coot/Moorhen/issues/13

Moorhen: does get_bonds_mesh_instanced() take the vertical bar?

Moorhen: Export input dictionary as string (needs to store result of file-to-string)

Moorhen: Request: electrostatic surface. What happens when you put the charges
         on a Gaussian surface?

Libcootapi: Make the CMakefile install chapi

Libcootapi: Make the CMakefile install findwaters and findligands

Libcootapi: add lib for gesamt

Libcootapi: from ligands meeting: Note to self: pdb header information:
        CAVEAT, from Gemmi to mmdb.

libcootapi: bring regularization to the api

libcootapi: bring conformer generation to the api. Do energy minimization and discard the
     high energy conformers

Fun: flattening difference map peaks animation:
        find peak and negative peaks in the
        current diff-map - previous diff-map difference map
        Use those peaks for particle animation.
        Make a moorhen function for these.

Fun: Add pops.

Science: Load JSG.cif from the RCSB and Get Monomer, run acedrg and load the the dictionary.
     Some of the Hydrogen atoms get disconnected on regularization.
     Why? (Note that the "Get Monomer" from the acedrg dictionary works OK - no flying Hydrogen atoms).

Science: Get the Cryo-EM servalcat difference map working

Science: analytical gradients for Gaussian surfaces

Science: Make a exponential_approx function that uses a pre-calculated table
         and use it to make smooth normals for the vertices of a gaussian surface.
         Extra points for multi-threading.

Useful: multi-thread the rmsd calculation, so that the Coot points
        calculation in cryo-EM maps is fast(er).

Science: middle of blob for EM jiggle-fitting, try 3908?

Science: "One button" post-jiggle fit "black box morph refine"
   o Make GM restraints,
   o blur
   o set tight restraints alpha
   o Refine
   o Lessen GM restraint alpha
   o Lessen blur
   o Refine
   Tricky thing is to find interesting cases.

Science/Useful: Calculate the RSR contact dots only for atoms with in ~12 A (say) of the
   centre of the screen.

Fix this in api/coot_molecule_maps.cc: Test N-threads in Moorhen:
// 20221126-PE set this for now. When it is restored, jiggle_fit_multi_thread_func_1 and jiggle_fit_multi_thread_func_2
// will need to be transfered.
// It is set (not configured) in ideal/simple-restraint.hh
#undef HAVE_BOOST_BASED_THREAD_POOL_LIBRARY

cif parser fail for 6eoj from the PDBe - display as CAs.
* set_use_gemmi_as_model_parser_xxx(1) fixes it

Moorhen: Request: electrostatic surface. Map electrstatic potention on to Gaussian surface.

Reading cif file with --pdb ~/Desktop/ejd/thing.cif seems borked (no file in file browser)

Cryo-EM -> Mask Map by Chain for 7vvl.

GUI: Quick save as should save the shader settings

GUI: Rigid-body refine the tutorial A chain. It used to display an intermediate atoms
representation. What happens now and is that what you want?
I want to add a notification where the "Coot Points" currently is.
If it moved then tell me previous fit score and current fit score.

GUI: Fix the undo molecule chooser (have 2 molecules with edits)


---- older issues ---

Auto-centre the user-suggestion for the centre of the blob when using
jiggle-fit. c.f. "Place Helix Here" initial centering.

Typical example of "what to do?"
  - Filo has been trying the Coot EM tutorial in Moorhen and finds some problem with
    "jiggle fit" - this is an interesting scientific problem - how far can you be away
  - Bogged down in tracking events and model coordinates and mesh and drawing updates
    for rotation/translation
  - Chatting with Jakub about Shortcuts but making no progress

Ribbons don't cast shadows.

No reaction to Aligment vs PIR (no PIR was loaded)

Size and user-defined "screen axis" displacement of atom labels, e.g. [0,0,5] to bring
the label towards the camera.

Issue 67:
On reflection, I will add a function that allows the user to override Coot's attempt to determine the EM-state of the map.

Layla: make python setup be available for Coot and Layla - put it in its own directory. So that layla
is not linked with src files.

Rob's problematic links
* Need details.

startup with default map opacity.

Jakub: sugar representation in RDKit and layla? (add it?) Tricky.

Where is Make Link? ::: 1.5
* Needs user-defined click click. Just do it in C++?
* Note that Make Link via Acedrg also needs user-defined click click (or a rewrite).

Colour rules (like Moorhen) need to be added to the Coot API.

Rewrite moorhen ligand fitting to use a vector of threads, not the thread pool.
* Low priority

Pyrogen needs to work ::: 2

Greg Crichlow cifs

Full-fat render path - i.e. framebuffer need to be set up correctly (at the right time?) ::: 2
set_framebuffer_scale_factor().
Well this works just like gtk3 version does. No effect on the framebuffer using "Fancy" path and
shows a quadrant in "Plane" mode. The output tga file is full-resolution though, which is nice.
Don't confuse the scaling of the framebuffer for screenshot (in "Plain" mode) and
the scaling of the framebuffers for super-sampling (in "Fancy" mode).
OK, so the framebuffer scaling works in simple mode.
Make it work in "fancy" mode and I will call it done.

Missing Bernie cherries

Fix build for St Judes Walid

2koc: do a Coot contact dots analysis on it.

Try using the instanced bonds using the api. Fix the specular lighting.

Test the conversion of glm quaternion to coot quaternion and back again. OK, done.
Test are in place. Now try again with the ligand orientation.

What about coot --no-graphics?

What about coot --version?

Fix crash on coot.coot_real_exit(0)
OK, so framebuffers are being deconstructed after call to exit().
It seem that framebuffers need to be deconstructed while the GL context is valid.
So it seems to me that they should be deconstructed as graphics_info_t is deconstructed. So add
their teardown() functions to ~graphics_info_t(). That prevents the crash I think.
However, the init_joey_ssao_stuff() are not initializing SSAO-gBuffer-framebuffer and effects-framebuffer
it seems. Yet they are being bound somewhere. Investigate further later by turning on fancy mode.
See partial-patch-for-framebuffer-teardown.patch.
Now I will revert.

Put the gtk version in the build_type? Currently Linux-x86_64-ubuntu-21.10-gtk4

I want to be able use "Fancy" shader path, but not use SSAO.

Rotation in Proportional Editing

Do we get Diegos for bad backbone neightbours O3' bumping int 05'? We
would need them for validating RNA backbone torsions.

Colour by chain (and dict?) but not by atom - i.e. how colour-by-chain used to work. This gives us
a nicer representation of ribosomes.

Use a state script for 2 model molecules - the first of which is undisplayed. The display manager
doesn't show that it's undisplayed ::: 0.6

Restore the draw() function in draw_ghost_bonds() in molecule-class-info.cc - needs a new class to do so.

In Moorhen, it's nice to work with the contact dots on. When I improve the fit and remove a clash, I want
to see something like the Moorhen points (but for the clash score, of course).

Make auto_read_mtz return the column labels - for Moorhen.

Updatating difference map for cryo-EM using ServalCat.

---- "Do they need to work?"/"Nice to have one day" items -----

locscale map viewer: colour map by other map?

Get an example of images->map from takanori and check that it works well in Coot and in the tomogram image mode

Find 3-10 helices and make restraints. Max Perutz wrote the first paper.

Nice to have:
"Resample map (say 11337 to 2.2) It takes a long time. There should be a progress bar.

Rework the namespace of the python modules to be more cannonical :::- 4
* I don't even know if this is possible
What does it mean to
import coot
import coot.utils?

User-defined sf for distances.

A cancel button on the Download EMD map progress bar dialog

NCS Jumping should use the correct matrix :::- 0.5
l28. Tried and failed. Test the conversion of glm quaternion to coot quaternion and back again.

Nice to have: Write a script that finds functions in glade-callbacks that are no longer used
(i.e. not in coot-gtk4.ui)

Nice to have: Unmodelled blobs are labelled with the residue to which they are closest.

Nice to have: 1E9 is not correctly horizontally adjusted.

Nice to have: Eleanor: (maybe not for here): How do I find the peaks of this map?

Go To (next) Ligand should use the correct matrix ::: 0.5
perpendicular_ligand_view() is the function. Does it work in gtk3? No.
* Tried and failed. Need to check conversion of quaterions between coot::quaterion and glm::quaternion.

Notes: GTK4 is needed for Vulkan and Vulkan is need for AMD FidelityFX Super Resolution and Nvidia thing (name?)

Alt-B (or Ctrl-B) to close the Validatin/Rama bar.

Make info_dialog() take a string.

Contact dots should be oriented so that when they pulse, they move along the line between the atoms. :::- 1
Also, elongate them? Not vdw dots though.

Sort the triangles so that the difference map looks OK in plain mode. Maybe this should go
above the line?

Nice to have: on a grey background, atom labels work well, but the distance labels do not.

Low Priority: history searching on python window up-arrow :::- 1

Think of a way to start-up with certain modules on (in Preferences) :::- 2
* Nice to have, not vital. Use the command line in the meantime.

Enable the command line (e.g. --pdb and others) :::- 2
* It's actually not clear that I need it!

Find a home for New molecule by sphere :::- 1

Find a home for New molecule by symmetry op :::- 1

Add base paring: on_other_tools_base_pair_toggle_button_toggled() :::- 0.5

I'd like to put coot_utils into coot so that it's coot.utils, likewise coot_gui, fitting etc.

struct_conn in mmdb for links : how  does it work and can they be displayed?

How about "Both" surface and lines for maps? Extra "Both" radio button.

Download 7a0l (or anything) doesn't have (doesn't display) links when reading from an mmcif!
OK, but this is a mmdb problem not a GTK4 Coot problem.

A benchmark in Curlew? Or built-in would be better.

Unmodelled blobs should have an "Update" button :::- 1

Caps lock key indicator?

Coot contact dots updated on model modification

residue spec -> rdkit python object at the coot api

How to represent a "Both" chirial (ambiguous) (are they the same thing?)

User-defined menus in Python - connected via coot_main_menumodel.

Comboboxes with entries for old molecule, or duplicated entries.

Map Skeletonization :::- 4

CA Baton Mode :::- 4

Recompile molecule-class-info-widget-work.cc and remove the compilation warnings :::- 6
* There's a lot of symmetry and NCS stuff in there that needs a large reworking.

End-caps on the O half bonds on the HOHs in 7a0l.

Fullscreen - maybe not possible in gtk4 :::- 0.2

Map Properties window close button :::- 0.5
* I had a look. Not sure what internal-child="action_area" means.

New Mesh algorithms:
https://swiftcoder.wordpress.com/planets/isosurface-extraction/
https://www.sciencedirect.com/topics/engineering/isosurface-extraction

Low Priority: think how to put the "Display Manager" into the main window :::- 6

Low Priority: "Add hydrogens using Refmac" should not cause a lock up - give me a nice progress bar :::- 4

Low Priority: How can I make a flatpak for Coot?

Find somewhere for auto-weight refinement coot_utils.auto_weight_for_refinement()

Pointer distances:  It should be an overlay one day

Coot Info dialog:  It should be an overlay one day

Note: 7UMH is beasty that would look good rendered with colour-by-NCS-related chains (and vdw balls).

void HUDTextureMesh::setup_buffers() { ...
// std::cout << "::::::::::: HUDTextureMesh::setup_buffers() " << name << " vao " << vao << std::endl;
Turn this on and do a RSR, see that the Button Texture meshes have a new vao for each draw!  :::- 1
* It will do for now these are HUD text. One day rewrite, but not today.

Dotted Surface :::- 1
* This exists and it draws OK, but I don't see how to change the colour yet.
  Changing the colour is very tricky beacuse balls is not part of the coot::dots_representation_info_t
  class. Perhaps it should be? (see add_dots()).

Undo molecule chooser should be an overlay.

"Accent Background" - 1: replace the blank background with a texture. 2: Make a texture using the current image
and blur it either using a framebuffer or by FFTing the image, truncating it and back transforming it (that
would allow the manipulation of the phases so that the background could morph (that might involve pre-generating
a number of textures and interpolating between them). Also consider a blurred textured blue background so that
it looks like the sea.  Or use texture background while Refmac is running.

Low Priority: 3D Annotations :::- 3
Nice to have: 3D text - related to model bulding last time. Or markers in 3D which give us a nice overlay
text annotations.

RCrane - Make this a Module. Fixing this will take a long time. :::- 20

When adding a water "WARNING:: new atom addition blocked by nearby atom" needs a visual cue (red sonar)
on the atom that is blocking. :::- 1

Light Mode, Dark Mode, Automatic (tracks background colour) :::- 1
Put this in preferences.

Change the colour of the Dotted Surface
* This exits and it draws OK, but I don't see how to change the colour yet.
  Changing the colour is very tricky beacuse balls is not part of the coot::dots_representation_info_t
  class. Perhaps it should be? (see add_dots()).

Update Dynamic validation on making links (the NBC clashes should disappear)

7a0l colour by B-factor with fat bonds. Bonds to hydrogen atoms are grey and fat. :::- 5
Also, waters are too big. Also waters are too big in colour by molecule.
Bonds to hydrogen/deuteriums are too fat "Colour by Occupancy" and "Colour by B-factor all".
Bonds to deuteriums in HOH are too fat in (default) "colour by atom" mode.
(also affects gtk3 coot - so think about fixing it there?).
See "fat atom" commits.

How should the "model representation change" work? Ctrl Shift 2-finger scroll? :::- 0.5
* This is too complicated and estoeric to fix now. I don't even know how to fix it.

AWC chirality in the ring - wedge bond is pointing in the wrong direction? Nice example of sp2 Se-ring (not aromatic)

Open dictionary should provide a widget to specify the molecule for dictionary.

--- Done Items ---

Boot Python  ::: 2
* Done!

"Load tutorial model and data" should results in only one copy of the maps in the Display Manager.
(model is not duplicated) ::: 1
* Done.

Fix up the Display Manager - try isolating it and use Cambalache ::: 4
* Done.

Get Coot Python modules loading ::: 2
* Done

"Reset View" seems to have focus on startup. Make it be the graphics window. ::: 1
* Done.

Up and down in the python scripting window ::: 0.5
* Done.

Fix the go to blob function ::: 0.5
* Done.

Fix "Go To Atom" dialog ::: 2
* Done.

Fix "AutoFit Rotamers" button ::: 1
* Done.

Fix "Simple Mutate" button ::: 1
* Done.

Fix "Mutate & AutoFit" button ::: 1
* Done.

Fix "Sidechain 180" button ::: 1
* Done.

Fix "Add Terminal Residue" button ::: 1
* Done.

Fix "Delete" button ::: 1
* Done.

Fix "Undo & Redo" buttons ::: 0.6
* Done.

"Header Browser" is broken  ::: 0.5
* Done.

Make the Fast-go-to-residue dialog work. ::: 0.5
* Done.

Button icons ::: 1
* Done.

Get Python gui scripts communication working ::: 2
* Done.

Get PyGObject working with GTK4 (Not a Coot thing) ::: 2
* Done.

Fixed Atoms click should show a menu, not a dialog ::: 1
* Done.

Make the "Fetch..." Functions work ::: 1
* Done.

Fixed Atoms click should show a menu, not a dialog ::: 1
* Done.

Get the Range button working (using new events) generic range define. ::: 2
* Done.

Add "Repeat previous zone" to refinement menu items. ::: 0.4
* Done.

Make the validation balls and dodecs less bright. ::: 0.3
* Done.

Make a "framework" program for validation for Jakub - make a list of generic residue validation blocks. ::: 4
* Done.

Display Manager - "Delete Model" button doesn't delete the "combobox" (as I called it) in the Display Manager ::: 1
* Done.

Display Manager - bond and colour selector is broken ::: 1
* Done.

Do some more experimenting with validation graphs ::: 5
* Done.

Fix the Pan/Ctrl-drag function ::: 1.0
* Seems to be done - I don't know how.

Does the show_updating_maps_chooser() work? In refinement branch even? ::: 1
* Don't know about refinement branch, but it works here now.

GUI: Unmodelled blobs dialog and the resulting blobs dialog. ::: 0.5
* Done. Nice.

New dialog for map masking ::: 0.5
* Done. Nice.

Get R/RC overlay dialog working  ::: 1
* Done. Nice.

clean out coot_gui usage from coot_utils ::: 2
* Done.

Validate -> Ramachandran Plot ::: 10
* Good enough.

Fix the Map Parameters dialog widgets ::: 5
* Good enough.

In the Display Manager, The "Delete Map" button doesn't delete the map row. ::: 1
* It does now.

Fix "Rotamers" button ::: 1
It just needs a bit of adjustment of the margins.
* Looks fine.

Get the "Map..." Button working. ::: 0.5

Can you make the rotamer dialog be an overlay? Not important. ::: 0
* No go to do this yet.

I think that one of the new buttons steals the focus from the graphics on startup now. ::: 0.5
* Done.

Key-binding for "clear all atom labels" ::: 0.25

Key-bindings in general ::: 1
May need revisiting.

Merge Molecules gui ::: 1.0
* Done.

Find Waters gui ::: 1.0
* Done.

Ctrl Arrow keys for ligand rotation and translation ::: 1
* Done.

"All" button in the Display Manager. Also the "Last Only" button. Maybe done in gtk3 merge? ::: 1
* Done.

Find Ligands gui ::: 3
* Done.

Coot Points in updating maps ::: 4
* Done.

Restart the refinement on button-release when dragging an atom ::: 0.5
call poke_the_refinement().

Difference Map Peaks ::: 2.5
* Done. Nice

Cell and Symmetry looks ugly - make it dynamic so the only button is "Close" ::: 1
* Done - good enough for now

Enable basic files on the command line ::: 4

Consider using double-click to do go to blob.  Where does "label atom" go then? Or how about middle-mouse on blob?
(pressing "G" on the keyboard is not intuitive). ::: 0.2
Double-click to recentre (G: go to blob) ::: 0.3
* Done. Let's see if I like it.

Draw -> Molecule -> Bond colours ::: 1
* A lot better.

How do I add a single water? ::: 0.5
* Added to key-bindings for now.  Take care to add it to the correct molecule though

When I am adding waters, don't let me add to the molecule if it is not displayed. ::: 0.2

File -> Delete Molecules dialog ::: 1
* Done. Nice.

Edit -> Residue Info: Fix up the dialog and toggle buttons ::: 2.5
* Done. What a grind. At least a 2.

Better/more completions and history in python scripting. ::: 3
* Done. What a grind!

Background colour ::: 0.4
* Done. Trivial

Pointer distances ::: 0.5
* They were mostly done already. Just the dialog needed cleaning up.
  It should be an overlay one day

Click on symmetry atoms ::: 1

Add back the icons in the info dialog ::: 1

"Add New Residue Type" in the "Add Other Solvent Molecules" dialog doesn't work ::: 0.5

Wed  3 May 2023 14:43:36 BST
check the HUD NBC blocks in 89A - shouldn't lots of them be be labelled with "this residue" marker? ::: 0.4
* Done. Now both atoms are added for the same NBC.

GtkGrid in Residue Info doesn't get cleared before a new residue widgets are added. ::: 0.4
* Delete all the children: clear_the_grid():

Make a better descision about which molecule is the one used for "place typed atom at pointer (water)" ::: 0.2

Make the Fast-go-to-residue dialog be an overlay? No. A transient will do for now. ::: 0.5

Fix "Edit Chi Angles" button ::: 1

Wed  3 May 2023 14:43:36 BST
check the HUD NBC blocks in 89A - shouldn't lots of them be be labelled with "this residue" marker? ::: 1

Restore ^C interrupt (python-related?) ::: 1

Add contact dots ::; 1
* Done.

Add molprobity contact dots ::: 1
* After one frame the lights get brighter. Strange.

Key binding for update Coot contact dots - built it? ::: 0.2
* Added to my key_bindings.py for now

Bring Python command history and completion into GTK4: ::: 2
   a9d101aa69a767583a085de9e3c8ae2449fe71fa
   3fc6cfe003683ab1180c0045387036068cc32294

Generic Display Objects is a mess ::: 2
* Much better now!

Enable splash screen: ::: 1
* I don't know how to make the window the right size! The image is display in 16 pixels width

Check/Delete Waters needs testing ::: 1
* Done.

Add highly-coordinated waters ::: 0.7
* Done. Nice

Delete on a Water fails (it works if "Residue" is selected) ::: 0.4
* Done. Trivial.

Other Modelling tools should be in the menu ::: 2
Get rid of "Other Modelling Tools" ::: 1
* Done.

Undo molecule chooser ::: 0.5
Find Somewhere for "Choose Undo Molecule" ::: 0.5
* Done. Hooray.

Put a bar/cyclinder under Diego so I can see the atoms. ::: 2
* Lovely interactive contact dots will do.

Find somewhere in refinement module for "Contact dots during refinement" ::: 0.0
* Already exists in the "Refine" module!

HOLE ::: 1

Making the window larger exposes more of the validation pane - even without validation graphs present ::: 1
No longer. But make the startup window wider. now app window is 1000x900.

Dotted Surface ::: 1
* This exits and it draws OK, but I don't see how to change the colour yet.
  Changing the colour is very tricky beacuse balls is not part of the coot::dots_representation_info_t
  class. Perhaps it should be? (see add_dots()).

7a0l.cif doesn't load from the command line (related to 7a0l-assembly.cif non-load, I guess).
It's a molecule not a dictionary. The command_line::add() function needs to detect the difference.
All molecule .cif files fail to load on the command line? e.g. 7uv7
Now, should this be "nice to have" or "must have"?
* Done.

Sharpen/Blur (mtz) map is missing ::: 1

Built-in key-binding for [,]. ::: 0.2

Open, close, reopen Bond Parameters, An extra molecule combobox is added. ::: 0.5

Check the links in all representation types (use PDB files) ::: 2
* 7a0l not perfect in colour-by-B and occ. Good enough for now.

Draw fixed atoms - anchors seems not to be working. Also, Angry Diegos are missing. Is this only on MacOS? ::: 1.0
* It works on the PC.
* Error in the shader.

Where are the rotating hydrogen bonds? ::: 0.5
Calculate -> Hydrogen Bonds?

7a0l colour by B-factor with fat bonds. Bonds to hydrogen atoms are grey and fat. ::: 2
* Fat bonds partial fix for B-factor and Occ modes.

Apply the symmetry colour from the Cell and Symmetry dialog ::: 1
* Done. At last. 2 attempts. Looks nice.

Save state via a file chooser dialog and Ctrl-S and use on the command line ::: 1
* Done.

This function needs an extra arg: "bool transfered_colour_is_instanced"
void
Mesh::draw_instanced(Shader *shader_p,
                     const glm::mat4 &mvp,
                     const glm::mat4 &view_rotation_matrix,
                     const std::map<unsigned int, lights_info_t> &lights,
                     const glm::vec3 &eye_position, // eye position in view space (not molecule space)
                     const glm::vec4 &background_colour,
                     bool do_depth_fog,
                     bool do_pulse,
                     bool do_rotate_z,
                     float pulsing_amplitude,
                     float pulsing_frequency,
                     float pulsing_phase_distribution,
                     float z_rotation_angle)

which gets sent to the shader of course. Check that both interactive atomic comtact dots and hydrogen bonds work.
(what else uses that shader?)   ::: 1
* Done.

7a0l-assemby.cif from rscb.org fails to import. Hmm! How to fix that!? Test case for gemmi-based import?
* Done.

Start up from Saved state. ::: 1
For now I can start by passing startup.py on the command line.

Change the label on the Refinement module's "Contact Dots on" menu item ::: 0.1
* Done.

Sort out whatever is going wrong with the display of the extra distance restraints. ::: 1
* Done.

Connect up the distances and angles dialog ::: 1
* It was easy. I could improve the position of the angle label.

Fix the double reading of the monomer library ::: 0.3
* Hopefully this won't break things.

Update the Ramachandran Plot after RSR or other model edits ::: 1
* Done. Nice.

Update the Validation Graphs after RSR or other model edits ::: 2.5
what is this: update_active_validation_graph_model()?
It is the function that gets called when the user changes the molecule in the validation graph dialog.
It is not the function to update the graphs when the model changes.

Validation graph colours ::: 1.0
* Mostly done. Needs some tweaking (e.g. in Density Correlation there needs to be some improved range).

Edit Restraints, Select Monomer type - dialogs messed up ::: 1
* Done.

Restraints Editor ::: 2
* Done.

Calculate -> Map Tools -> Copy Map doesn't work ::: 0.5
* Done. And smoother versions.

Intercept "Get Monomer" or "Search Monomer" 3GP and give me a conformation that fits more easily ::: 1
* Grindy finding the bug (was not editing the correct dictionary).

rename draw-2.cc as tick-function.cc or some such

On changing the selection in the rama plot, it says "now do something with //A". So you should do that. ::: 0.5

Rama plots need to read the imol in on_ramachandran_plot_molecule_chooser_ok_button_clicked() ::: 0.1

Go into perspective project and with left-mouse pressed wave around the mouse wildly ::: 0.2
*Done. Added stabilization in mouse_zoom().

Curlew: Goodsell, speed-run and CaBLAM ::: 5
* Monster effort - rewrite from scratch.

Open Coordinates -> Move Molecule Here -> Open doesn't work  ::: 0.5

Edit->Move Molecule Here... Do it twice and the combobox duplicates ::: 0.5
Needs a check before adding a combobox?
* Done.

Add a window-removed signal callback for Bernie? ::: 0.2
void
window_removed (
  GtkApplication* self,
  GtkWindow* window,
  gpointer user_data
)
* I added a note:

Missing main-chain C atom in colour-by-chain. ::: 0.5
* Done. Commented out a big hunk of code. Make instancing work.

Where is "Add Atom at Pointer"? Do I mean for waters and metals to be added using "Add Other
 Solvent Molecules"? No. Modelling -> Add an Atom: Then can be Water, or anions and cations ::: 1

rename residue, renumber waters, reorder chains, replace fragment, use SEGIDs in Edit menu ::: 0.2
* Done ages ago.

Do the tutorial from time to time - what's missing? ::: 6
graphs, validation graphs colours, updates of rama, clash dots on model change.
change the function name update_validation_graphs() to update_validation() and after that change the name back and call
the dot updates and update_validation_graphs() from there.

Key-binding/function to bump the B-factors up or down or match the neighbourhood. ::: 0.2
* Done

Clear the box of results in Unmodelled Blobs ::: 0.4

Put GLM into configure, get rid of --with-gtk4 ::: 0.5


Fix icon on startup: (coot-bin:15976): Gtk-WARNING **: 14:16:15.373: Could not load image 'pixmaps/coot-icon.png': Error opening file /usr/local/Cellar/cootgtk4/HEAD-b70d63f/share/coot/glade/pixmaps/coot-icon.png: No such file or directory ::: 0.5

Put the curlew banner in the curlew dialog ::: 1

Make the Ligand Menu be a module ::: 0.5
Not much to do until we turn on RDKit.
# Some of these are vital, some are nice to have
Find Ligands ::: 0.1
Jiggle-fit ligand ::: 0.2
Hydrogenate region ::: 1
Contact dots for ligand ::: 0.2
SMILES -> simple 3D ::: 1
Show Chemical Features ::: 2
Display Ligand distorsions ::: 1
Quick Ligand Validate ::: 3
Isolated Molprobity dots for this ligand - what is this? How is it different to contact dots for ligand?
   contact_score_ligand_func(). Hmm.
[Ligand Metric Sliders]

"About Coot" is empty (was fixed in GTK3 version). Remake it in Cambalache?  ::: 0.5
* Nearly done - I need to be able to install the icon.


"Ligands" selection in Go To Atom ::: 0.5

"Overlaps" needs an update button - and preferably updates automatically. ::: 3

Edit -> Mutate Residue Range ::: 2
* Done. Thanks Jakub.

Map Parameters dialog needs a refresh ::: 0.5
* Done. Nice

Bug: make Contact Dots, open Generic Objects dialog , Close, Add new contact dot and then open generic objects dialog
again. Mess as some box entries are double written. ::: 1
* Done, I think. Use clear_the_grid()


"Add atom" should boink if the new atom is over/close to an already existing atom ::: 0.5
(Maybe it does already)
* Now I get a warning dialog - good enough

Draw the ligand chemical diagram in OpenGL. ::: 3
* Done. Good. But still some scaling issues.

Nasty "-" rendering in OpenGL for charged atoms in HUD Ligand ::: 0.5
* Done 375716e7198e9df624449790378d383daa4f6370

Views ::: 2
* Simple implementation

Open dictionary should provide a widget to specify the molecule for dictionary.
Also a "Generate Molecule" button. ::: 0.4

Clemens: If I mutate a residue with hydrogen atoms, make the new atoms have hydrogen atoms too.
It would be good if you could make them nucleus hydrogens if that's what was deleted. ::: 1

Clicking on Green left arrow doesn't open the refinement overlay ::: 1
* Done.

Shift the HUD ligand 10 pixels to the right, i.e. add 0.02 to x in the shaders. ::: 0.5
* Done.

In graphics_info_t::new_fill_combobox_with_coordinates_options() gtk_combo_box_set_active() doesn't work.
Why? Because it's looked up and not new? ::: 2
* Done. 215d1cf6eb4c55a3a2fe66c6437df17983f19da5. Maybe more like this.

Quick save should say something in the status-bar - maybe briefly flash and fade the background. Or some
other brief visual effect. ::: 0.5
* Done.

Looks at 1x8b with ligands and contact dots - is 2.0 too close for H-O hydrogen bond distance?
No, it's fine: see https://proteopedia.org/wiki/index.php/Hydrogen_bonds. Contact dots has it as
a clash though. "The dotted hydrogen bond is non-covalent and variable in length, ~1.5-2.5 Å." ::: 1
* Done in refinement.

Bug: Add Hydrogen atoms fails for 1x8b/824 - missing on N :: 4
Something to do with the dictionary? No. With new dictionary it still fails. The type for N is NR5.
This is wrong. It should be NR15. So, when the atom type is NR5, then check the bonds to the atom, to see
if there is an N-H bond.
* Done.

Search monomer library results should be left-hand justified ::: 0.5
* Done

Search monomer library results should have rdkit images? ::: 0.5
* Done

Isolated Molprobity dots for this ligand - what is this? How is it different to contact dots for ligand?
   contact_score_ligand_func(). Hmm. See ~/Desktop/ligand-notes
* Contact dots for ligand is my function - it has vdw dots

Shader Preferences can submarine ::: 0.2
* Done.

What's up with the Preferences? ::: 6
* Done - well lots of it done. What a grind.

Add Jiggle-Fit functions to Cryo-EM tools ::: 0.6
* Done.

Anti-submarine the Display Manager ::: 0.2
* Done.

Fetch EMD map ::: 1
* Done.

Find somewhere for coot.set_b_factor_bonds_scale_factor ::: 1
* Preferences, surely.

Something is wrong with the generation of the guile code. ::: 0.2
* No... it was just not compillled wth guile. Still startup issues need
  to be resolved, I think.

Fix the dynamic validation pane resize on Update of the buttons ::: 0.2
* Done. gtk_paned_get_position().

Pulling on atoms during refinement doesn't work with trackpad on macOS. ::: 2
* Done. Let's see how it integrates with regular mouse usage.

Do the tutorial from time to time - what's missing? ::: 1
* Nothing. It works.

Full-fat render path - i.e. framebuffer need to be set up correctly (at the right time?) ::: 2
set_framebuffer_scale_factor().
Well this works just like gtk3 version does. No effect on the framebuffer using "Fancy" path and
shows a quadrant in "Plane" mode. The output tga file is full-resolution though, which is nice.
Don't confuse the scaling of the framebuffer for screenshot (in "Plain" mode) and
the scaling of the framebuffers for super-sampling (in "Fancy" mode).
* Now the framebuffer scaling for the basic/simple mode work (fat density lines appear)

Preferences -> Colours -> Font does not work ::: 1

"Atom Label Font Size" frame should be deleted from the properties. ::: 0.5

[ and ] don't change the cryo-EM map radius. ::: 0.2

Rename python modules fitting, get_ebi, gui_hole, mutate, ncs, pathology and others ::: 0.5
https://github.com/microsoft/vscode-docs/blob/vnext/release-notes/v1_63.md#python
(that vs code thing didn't work - no clevernesss suggested)

How do I invoke the sequence view? ::: 0.1
* Add a menu item

Ligands in 6l01 and 7tzz fall off the page
* Improved. Still needs work.

How do I dismiss the sequence view? ::: 1
* Done.

From Stuart: 1h27 fails on read cif. ::: 1
Make Coot use GEMMI.
* Done.

Open Check/Delete Waters dialog twice.
I want alignment by using a Grid.
I want distance in the button label.
I want the results box to be docked.
It needs an extra distance criterion for distance to a hydrogen atom. ::: 2


Make the run-script dialog be transient ::: 0.2
* Done.

add a "Grab focus" before going in to fullscreen! ::: 0.5
* Done.

Turn on Intermediate atom All-atom contact dots, refine and accept. The contact dots
 should disappear but they don't ::: 1
* Done.

Tweak down the perspective a notch.
* Done.

Is the em radius saved to the state file? :: 0.2
It is now.

Are the cis-peptides markers being generated and displayed? ::: 1
They are non-instanced geometry. Should I just use api/instancing.hh?
* Yes. A slog, but a Good Thing in the end.

Make the OK button in the single map parameters dialog bigger ::: 0.5

Add a graphics_draw() at the end of the calculation of map after contour level change (in the callback, I guess). :: 0.
* Done.

Clean up "store_window_position()" usage ::: 0.2
* Done.

Save Coordinates dialog is not working ::: 0.6
* Done.

Fresnel mode for maps in "Plain" mode ::: 1
* Done.

Bring the script that shows the SSOA buffer to GTK4 and try to fix the aniostropy. ::: 1
  The SSAO for model is not anisotropic now that we use the new instanced code (if it ever was).
  The SSAO for map is though. Compare and constrast with the model shaders.
* Done. Yay.

Proportional editing ::: 1
* Done. Nice.

Make Local distances restraints 5 ::: 1
* Done. Nice.

The Restraints menu needs a "Delete Extra Restraints" button. ::: 0.5
* Done. Nice.

Go into CA mode and try to middle-mouse over an atom that is not displayed. The recentering works.
The atom picker needs to know about the representation type (or act on it) ::: 0.1
* Can't reproduce (thankfully?)

Make sure that set_scroll_wheel_map and set_scrollable_map() (how are they different?) change the scroll indicator
in the Display Manager. ::: 0.5
* Done.

Don't draw cis-peptide markup for an MDO ::: 0.8
* Done. Pretty tricky.

Blog tutorial: why do we change the default B-factor? ::: 0.2
* Done.

Fetch EMDB map doesn't check the cache/coot-download.
* It does now.

No reaction to Validate -> Atoms with Zero Occs (there were some) ::: 0.5
* Done.

Fix this: ::: 1
"widget main_window_meshes_frame was not found"
* Done. Mow there is a ribbons dialog

Missing difference map peaks in 1bl8 from Oliver Clarke. ::: 1
* Done

a7956aa695f8c19e52622447ca292434812d4e62. ::: 0.1
How about deleting the timeout altogether?
* OK, done.

Moorhen: Fourier filter jiggle fit:
* Done.

Moorhen: read_ccp4_map() with the wrong file name
* Done.

Moorhen: map histogram - user chooses number of bins, I guess 50?
* Done.

Moorhen: libcootapi neeeds to return the columns that it has read in auto-read.
* Done.

Fix the R/RC combo-box changed handlers.
* Done.

Colour by B-factor CA is wrong: test with tutorial and 8oie.
          B-factor all doesn't work at all.
* Done.

Missing validation items: Some currently under Draw -> Molecule
   "Residues with Alt Confs" and
   "Residues with Missing Atoms"
   "Residue with cis-peptide" action needs to be filled
   "Residue type selection" action needs to be filled  <- This one remains to be done.
* Done. A bit of a fudge and what a grind - boring.

Clicking the switch Refine -> GM Restraints doesn't undisplay the GM restraints.
* Done. Easy.

Put 7vvl in CA mode. You can label atoms that are not displayed. Bad.
* Can't reproduce.

Moorhen: carbon bonds are too light on white background. Looking at the code, it seems
         to do the right thing, but needs testing. Print the colour table.
* Colour table seems fine. Needs a look.
* Done. Not a libcootapi problem.

sharpen_blur_with_resampling to moorhen api
* Done.

Save coordinates chooser and dialog is broken.
* Done.

Copy Fragment buttons need more space.
* Jakub Done.

Atsushi Nakagawa wrote:
>    I cannot display the PDB1uv6 on coot
* Still broken?
*   Looks OK to me now.

no_sound()
* Done.

Moorhen: Check/Delete waters function for the api
* Done.

Moorhen: test robustness of jiggle-fitting. Move the molecule around a bit and
         see if you get solutions.
         Use the nanobody in 7vvl.
         Use one of the WD40 domains in 6eoj
* Done - good enough for now

Moorhen: Read gziped maps in libcootapi, so moorhen can get maps from emdb.
* Done.

Moorhen: auto-read-mtz needs to return the Fobs and sigFobs also (if possible, of course)
  add std::string F_obs and sigF_obs to auto_read_mtz_info_t
  They were not set if F_obs is empty.
* Done

Apply Charles patches.
* Done.

"Solidify maps" in Cryo-EM module menu
* Done

No sound api.
* Done.

Outliers only in Rama plots
* Done.

Residues-near-residues
* Done.

Use "updating maps" a second time.
* Done. Added protection.

coot.halloween()
* Done.

Moorhen:: check waters: change the return type so that there is a label or some such.
(or the reason why it was an outlier)
* Already done

Rebuild RDKit, check that Eigen is pulled in correctly.
* Done.

GUI: Where is pepflip Q in the key-bindings?.
* Done.

GUI: "Use Trans-peptide restraints" button doesn't work (the button is on again
    when the dialog is displayed again).
* Done.

GUI: --auto moorhen-tutorial-4.mtz doesn't auto-read the Fobs colums, so the
     auto-updating maps doesn't work sadly.
* Done

Martin Moncrieffe: distance and angles on Mac.
* Done.

